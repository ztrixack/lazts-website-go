---
title: พื้นฐานของ GPIO และเรื่องที่เกี่ยวข้อง
slug: 20161030-gpio-fundamental
excerpt:
featured_image: https://picsum.photos/1024/768?random=12
published_at: 2016-10-30
last_updated_at: 2024-05-20
published: true
tags:
  - embedded
---

# พื้นฐานของ GPIO และเรื่องที่เกี่ยวข้อง

แน่นอนว่าคนที่เริ่มเข้ามาในวงการ embedded systems หรือแม้แต่มือใหม่ที่เพิ่งลองเล่นกับบอร์ดไมโครคอนโทรลเลอร์ ก็มักจะเริ่มต้นด้วยการใช้ GPIO เพื่อเปิดไฟ LED กันทุกคนเลย มันเหมือนกับว่าเป็น “Hello World” ของการเริ่มพัฒนาอุปกรณ์สมองกลเลยทีเดียว

แต่ถึงแม้ว่า GPIO จะดูเรียบง่ายและเป็นจุดเริ่มต้นของหลายๆ คน แต่การทำความเข้าใจการทำงาน วงจร และความสามารถของมันเป็นสิ่งสำคัญสำหรับการออกแบบและดูแลระบบ โดยเฉพาะกับคนที่ไม่มีพื้นฐานทางไฟฟ้า

ในบทความนี้ เราจะมาลงลึกเกี่ยวกับ GPIO กัน เพื่อรวบรวมข้อมูลทุกอย่างเท่าที่รู้มาไว้ในที่เดียว เผื่อเวลาลืมจะได้มาทบทวนกันใหม่ :D

## 0. พื้นฐานที่ควรรู้ก่อน

เผื่อใครที่ไม่ได้อยู่ในสายวิศวกรรมไฟฟ้า หรือคืนอาจารย์ไปหมดแล้ว ก็ขอใช้พื้นที่ตรงนี้ในการทบทวนก่อนนะ

1. High impedance Pin (Hi-Z)
  เป็นขา I/O ที่อยู่ในสถานะที่มีความต้านทานสูงมากๆ กระแสไฟแทบจะไม่มีเลย ส่งผลให้การใช้พลังงานน้อยลง และไม่มีสัญญาณไปรบกวนสายสัญญาณอื่นๆ
2. Floating Pin
  เป็นขาที่เราปล่อยลอยๆ ไม่ต่อกับวงจรภายนอกและระบบก็ไม่ได้ขับสัญญาณออกมา ระดับแรงดันไฟฟ้าจึงจะวัดไม่ได้เพราะไม่ครบวงจร
3. GPIO Port
  เป็นกลุ่มของ GPIO Pin หลายๆ ขาที่รวมกันเพื่อความสะดวกในการใช้งาน
4. Digital Signal
  สัญญาณดิจิทัลมีสองสถานะคือ Logic '0' และ Logic '1' โดยใช้ระดับแรงดันไฟฟ้าในการแบ่งสัญญาณ
5. Schmitt Trigger
  วงจรที่ใช้ในการแปลงสัญญาณอนาล็อกที่มีการเปลี่ยนแปลงช้าให้เป็นสัญญาณดิจิทัลที่มีขอบคมและเสถียร
6. Voltage Levels
  ระดับแรงดันไฟฟ้าที่ใช้ในการกำหนดสถานะ Logic '0' และ Logic '1' โดยทั่วไปจะมีการกำหนดค่ามาตรฐานสำหรับแต่ละระบบ เช่น 0V สำหรับ Logic '0' และ 3.3V หรือ 5V สำหรับ Logic '1'


## 1. GPIO คืออะไร

GPIO (General-Purpose Input/Output) เป็นส่วนประกอบหลักของอุปกรณ์อิเล็กทรอนิกส์แทบทุกประเภท โดยเฉพาะบนไมโครคอนโทรลเลอร์ คิดง่ายๆ เลยว่าถ้าอันไหนมีปุ่มกด มีไฟวิบวับ อันนั้นก็คือใช้งาน GPIO ทั้งนั้น เพราะมันเป็นตัวกลางหลักในการส่งสัญญาณเข้าและออกจากไมโครคอนโทรลเลอร์ ซึ่งเราสามารถกำหนดให้ทำงานตามโปรแกรมที่ตั้งไว้ได้

รูปแบบของ GPIO จะแบ่งออกเป็น 4 รูปแบบคือ:

1. **Digital Output** - ส่งสัญญาณดิจิทัลออกไป เช่น การเปิดหรือปิดไฟ LED
2. **Digital Input** - รับสัญญาณดิจิทัลเข้ามา เช่น การตรวจสอบสถานะของปุ่มกด
3. **Analog Input** - รับสัญญาณอนาล็อกเข้ามา เช่น การอ่านค่าจากเซนเซอร์
4. **Alternate Function Output** - ใช้งานขา GPIO สำหรับฟังก์ชั่นพิเศษอื่นๆ เช่น การสื่อสารผ่าน I2C หรือ UART

*** บางที่บางตำราอาจจะแบ่งได้มากน้อยหรือแตกต่างไปจากนี้ แต่ตรงนี้ไม่ใช่ประเด็นสำคัญอะไร เป็นเพียงการแยกแยะให้ดูเข้าใจง่ายๆ เฉยๆ นะ

## 2. รูปแบบของ GPIO

### 2.1 Digital Output

หากเคยทำ LED ให้สว่างได้ แสดงว่าเคยใช้ Digital Output แน่นอน โดย Digital Output เป็นการส่งสัญญาณดิจิทัลจากไมโครคอนโทรลเลอร์หรืออุปกรณ์สมองกลไปยังอุปกรณ์ภายนอก เช่น LED, รีเลย์, มอเตอร์ หรือวงจรอื่นๆ โดยทั่วไปแล้วจะมีสองสถานะหลักคือ Logic '0' และ Logic '1' ซึ่งสามารถแบ่งออกเป็นสองรูปแบบหลักในการขับสัญญาณ คือ Push-Pull และ Open-drain

#### Push-Pull Output

![Push-Pull](gpio-fundamental-pull-push.webp)

<i align="center">
  schematic แบบง่ายๆ ของ push-pull output
</i>

Push-Pull Output เป็นรูปแบบการขับสัญญาณที่ใช้ PMOS และ NMOS ทรานซิสเตอร์เพื่อควบคุมการส่งสัญญาณไปยังขาเอาต์พุต ในรูปจะเป็น Push-Pull Output แบบง่ายๆ ตัดส่วนที่ยังไม่เกี่ยวข้องออกไป ของจริงจะยุบยับกว่านี้มาก 

สำหรับ internal GPIO ในไมโครคอนโทรลเลอร์จะมีการใช้ PMOS ทรานซิสเตอร์ต่อกับแหล่งจ่ายไฟ (VDD) และ NMOS ทรานซิสเตอร์ต่อกับกราวน์ (GND) ในการทำ Push-Pull Output ซึ่งก็จะมีช่วงการทำงานแยกกันตามรูป

 - Push/Source: เมื่อสั่ง Logic '1' จากไมโครคอนโทรลเลอร์ สัญญาณจะถูกอินเวิร์ต (invert) ทำให้ PMOS ทรานซิสเตอร์เปิด และกระแสจากแหล่งจ่ายไฟ (VDD) จะไหลผ่านขาเอาต์พุตไปยังอุปกรณ์ภายนอก
 - Pull/Sink:  เมื่อสั่ง Logic '0' จากไมโครคอนโทรลเลอร์ สัญญาณจะถูกอินเวิร์ต ทำให้ NMOS ทรานซิสเตอร์เปิด และกระแสจากอุปกรณ์ภายนอกจะไหลผ่านขาเอาต์พุตลงกราวน์ (GND)

![Push Phase](gpio-fundamental-pull-push-push-phase.webp)

<i align="center">
  กระบวนการในช่วงของการ Push/Source ส่งกระแสไฟฟ้าจากแหล่งจ่ายไฟ (VDD) เข้า Load 
</i>

![Pull Phase](gpio-fundamental-pull-push-pull-phase.webp)

<i align="center">
  กระบวนการในช่วงของการ Pull/Sink ดึงกระแสไฟฟ้าจาก Load ลงกราวน์ (GND)
</i>

จะเห็นว่ารูปแบบนี้ไม่ได้เหมาะกับการแชร์สายสัญญาณร่วมกับหลายๆ อุปกรณ์เลย เพราะอาจจะทำให้กระแสไฟจากไมโครคอนโทรลเลอร์ถูกดึงลงกราวน์จากอุปกรณ์อื่น หรือไปหาดึงกระแสไฟชาวบ้านเขาได้ จึงเหมาะสำหรับการส่งสัญญาณที่มีการวิ่งทางเดียวและการขับอุปกรณ์โดยตรงมากกว่า เช่น LED หรือรีเลย์ เนื่องจากสามารถให้กระแสได้มากพอและควบคุมได้ง่าย

ในกรณีที่อยากจะเปลี่ยนจาก Output เป็น Input ด้วยรูปแบบ Push-Pull เองสามารถเปลี่ยนเป็น Input ได้โดยการปิด transistor ทั้ง 2 ตัวเพื่อให้ Output Pin มีสถานะเป็น Hi-Z ซึ่งเดี๋ยวจะพูดถึงใน Digital Input

#### Open-drain Output

![Open-drain](gpio-fundamental-open-drain.webp)
<i align="center">
  schematic แบบง่ายๆ ของ open-drain output
</i>

Open-drain Output ใช้ NMOS ทรานซิสเตอร์เพียงตัวเดียวในการควบคุมการส่งสัญญาณ ซึ่งจะต่างจาก Push-Pull Output ที่มี PMOS ทรานซิสเตอร์ด้วย จึงส่งผลต่อพฤติกรรมของขาเอาต์พุตดังนี้

  - Pull/Sink: เมื่อสั่ง Logic '0' จากไมโครคอนโทรลเลอร์ NMOS ทรานซิสเตอร์จะเปิด และกระแสจากอุปกรณ์ภายนอกจะไหลผ่านขาเอาต์พุตลงกราวน์ (GND) เหมือน Push-Pull Output
  - High Impedance (Hi-Z): เมื่อสั่ง Logic '1' จากไมโครคอนโทรลเลอร์ NMOS ทรานซิสเตอร์จะปิด ทำให้ขาเอาต์พุตเป็นวงจรเปิด (Open Circuit) และไม่มีกระแสไหล

![Open-drain closed circuit](gpio-fundamental-open-drain-closed-circuit.webp)
<i align="center">
  กระบวนการในช่วงของการส่ง Logic '0' และดึงกระแสไฟลง
</i>

![Open-drain open circuit](gpio-fundamental-open-drain-open-circuit.webp)
<i align="center">
  กระบวนการในช่วงของการส่ง Logic '1' จาก Pull-up resister
</i>

Open-drain Output มักใช้กับวงจรที่ต้องการการแชร์สายสัญญาณร่วมกับอุปกรณ์หลายตัว (เช่น I2C) หรือวงจรที่ต้องการใช้แรงดันไฟฟ้าที่สูงกว่าความสามารถของไมโครคอนโทรลเลอร์ เพราะเราสามารถที่จะต่อเพิ่มระดับแรงดันจากภายนอกแทนที่จะมาจากไมโครคอนโทรลเลอร์ตรงๆ ซึ่งอาจจะถูกจำกัดปริมาณกระแสจาก I/O หรือแรงดันไม่เหมาะกับอุปกรณ์ปลายทาง

#### GPIO Output Speed

ความเร็วของ GPIO Output หมายถึงความเร็วในการเปลี่ยนขอบขาหรือ Logic State จาก '0' เป็น '1' หรือจาก '1' เป็น '0' ยิ่งการเปลี่ยนสถานะเร็วขึ้น ยิ่งกินพลังงานมากขึ้นและเพิ่มสัญญาณรบกวนทางแม่เหล็กไฟฟ้า (EMI)

ดังนั้นเราก็ควรจะตั้งค่าความเร็วให้เหมาะกับงานด้วย เช่น 

- สำหรับสัญญาณที่ไม่ต้องการความเร็วสูง เช่น GPIO toggle ง่ายๆ ควรตั้งค่าให้ช้าเพื่อลดการใช้พลังงานและ EMI
- สำหรับสัญญาณที่ต้องการความเร็วสูง เช่น SPI หรือ UART ควรตั้งค่าให้เร็วพอที่จะส่งข้อมูลได้ทัน

#### การใช้งาน Digital Output

การใช้งาน Digital Output ในทางปฏิบัตินั้นต้องมีการพิจารณาหลายปัจจัย เช่น:

1. แรงดันและกระแสไฟฟ้า: ต้องแน่ใจว่าแรงดันและกระแสไฟฟ้าของ GPIO เพียงพอสำหรับอุปกรณ์ที่เชื่อมต่อ หากไม่เพียงพอ ควรใช้ทรานซิสเตอร์หรือรีเลย์เพื่อขับอุปกรณ์
2. การป้องกันวงจร: ควรมีการใส่ตัวต้านทาน (Resistor) เพื่อป้องกันการเกิดกระแสเกินที่อาจทำให้ GPIO หรืออุปกรณ์เสียหาย
3. การจัดการสัญญาณรบกวน: การเปลี่ยนสถานะเร็วเกินไปอาจทำให้เกิด EMI ควรใส่ตัวเก็บประจุ (Capacitor) หรือใช้การออกแบบวงจรที่ดีเพื่อป้องกัน

ตัวอย่างการใช้งาน Digital Output ที่ใช้โดยทั่วๆ ไปก็จะเป็นการเชื่อมต่อกับอุปกรณ์ต่างๆ

1. การควบคุม LED: การเปิด/ปิด LED เป็นตัวอย่างพื้นฐานของการใช้ Digital Output เมื่อสั่ง Logic '1' กระแสจะไหลผ่าน LED ทำให้ LED สว่าง เมื่อสั่ง Logic '0' กระแสจะหยุดไหล ทำให้ LED ดับ และเพื่อลดกระแสไฟที่ไหลผ่าน LED เพื่อป้องกันการเสียหาย ก็ควรใช้ตัวต้านทานแบบ Series ใส่ลงไปก่อนผ่าน LED ด้วย
2. การควบคุมรีเลย์: จะใช้ในการเปิด/ปิดรีเลย์เพื่อควบคุมการทำงานของอุปกรณ์ไฟฟ้าที่ใช้แรงดันสูงกว่า และควรใช้ทรานซิสเตอร์ในการขับรีเลย์ เนื่องจากรีเลย์ต้องการกระแสสูงกว่าที่ GPIO จะขับได้
3. การควบคุมมอเตอร์: การใช้เพื่อควบคุมการเปิด/ปิดมอเตอร์หรือการกำหนดทิศทางการหมุนของมอเตอร์ผ่านวงจรขับมอเตอร์ (Motor Driver) ควรใช้วงจรขับมอเตอร์ที่มีทรานซิสเตอร์หรือ MOSFET เพื่อควบคุมการทำงานของมอเตอร์ และใช้วงจรป้องกันกลับขั้ว (Flyback Diode) เพื่อป้องกันกระแสย้อนกลับด้วย

#### สรุป

Digital Output เป็นพื้นฐานที่สำคัญในการควบคุมอุปกรณ์ต่างๆ ผ่านไมโครคอนโทรลเลอร์ การทำความเข้าใจการทำงานของ Push-Pull และ Open-drain รวมถึงการพิจารณาแรงดัน กระแส และการป้องกันวงจร เป็นสิ่งสำคัญในการออกแบบและพัฒนาระบบอิเล็กทรอนิกส์ที่มีประสิทธิภาพและปลอดภัย


### 2.2 Digital Input

ปุ่มกดแทบทุกชนิดล้วนมีพื้นฐานมาจาก Digital Input เพราะมันเป็นการรับสัญญาณดิจิทัลเข้าสู่ไมโครคอนโทรลเลอร์หรืออุปกรณ์สมองกลจากอุปกรณ์ภายนอก เช่น ปุ่มกด เซ็นเซอร์ หรือสวิตช์ เป็นต้น ในการตรวจสอบสถานะของสัญญาณที่เข้ามา เช่น ตรวจสอบว่าปุ่มกดถูกกดหรือไม่ ก็จะใช้แรงดันไฟฟ้าในการแบ่งสัญญาณเป็น Logic '0' และ Logic '1'

 - Logic '0': แรงดันไฟฟ้าต่ำ (ใกล้ 0V)
 - Logic '1': แรงดันไฟฟ้าสูง (เช่น 3.3V หรือ 5V ขึ้นอยู่กับระบบ)

เราจะมาดูกันว่าจะสามารถเล่นอะไรกับมันได้บ้าง

#### No Pull-up and no Pull-down (Floating Pin)

Floating Pin คือขาที่ปล่อยลอยๆ และไม่มีการต่ออะไรเพิ่มจากภายใน หากไม่มีการขับสัญญาณจากภายนอกหรือไม่มีการต่อวงจรใดๆ ที่ Pin นี้ ขาจะมีสถานะเป็น Hi-Z ซึ่งทำให้เกิดค่าที่ไม่แน่นอนและเป็นไปได้ว่าจะมีสัญญาณรบกวนได้ง่าย จึงต้องมีการต่อ Pull-up/Pull-down จากวงจรภายนอก หรือกำหนดสถานะไว้อยู่แล้วว่าเป็น '0' หรือ '1' เพื่อป้องกันการอ่านข้อมูลผิดพลาด

##### Pull-up Resister

Pull-up Resistor ใช้ตัวต้านทานเชื่อมต่อขา GPIO เข้ากับแหล่งจ่ายไฟ (Vcc) เพื่อคงสถานะ Logic '1' เมื่อไม่มีการขับสัญญาณไฟฟ้าเข้ามา การใช้งานนี้มักควบคู่กับสัญญาณแบบ Active Low เพื่อให้ขา GPIO อยู่ในสถานะ Logic '1' เมื่อไม่มีการกดปุ่ม และเปลี่ยนเป็น Logic '0' เมื่อปุ่มถูกกด

![Pull-up Resister circuit](gpio-fundamental-pull-up-resister-circuit.webp)
<i align="center">
  กระบวนการในช่วงของการอ่าน Logic '1' จาก Pull-up resister
</i>

เมื่อปุ่มไม่ได้ถูกกด GPIO Pin จะอ่านค่าเป็น Logic '1' แต่เมื่อปุ่มถูกกด GPIO Pin จะถูกเชื่อมต่อกับกราวน์และอ่านค่าเป็น Logic '0'

##### Pull-down Resister

Pull-down Resistor ใช้ตัวต้านทานเชื่อมต่อขา GPIO เข้ากับกราวน์ (GND) เพื่อคงสถานะ Logic '0' เมื่อไม่มีการขับสัญญาณไฟฟ้าเข้ามา การใช้งานนี้มักควบคู่กับสัญญาณแบบ Active High เพื่อให้ขา GPIO อยู่ในสถานะ Logic '0' เมื่อไม่มีการกดปุ่ม และเปลี่ยนเป็น Logic '1' เมื่อปุ่มถูกกด

![Pull-down Resister circuit](gpio-fundamental-pull-down-resister-circuit.webp)
<i align="center">
  กระบวนการในช่วงของการอ่าน Logic '0' จาก Pull-down resister
</i>

เมื่อปุ่มไม่ได้ถูกกด GPIO Pin จะอ่านค่าเป็น Logic '0' แต่เมื่อปุ่มถูกกด GPIO Pin จะถูกเชื่อมต่อกับแหล่งจ่ายไฟและอ่านค่าเป็น Logic '1'

#### Debouncing

Debouncing คือกระบวนการลดสัญญาณรบกวนที่เกิดขึ้นเมื่อกดปุ่มหรือสวิตช์เพื่อให้ได้สัญญาณที่เสถียรและถูกต้อง เมื่อกดปุ่มหรือสวิตช์จะมีการสั่นสะเทือนทางกลไกที่ทำให้เกิดสัญญาณรบกวน ซึ่งทำให้ไมโครคอนโทรลเลอร์อ่านค่าผิดพลาด

การทำ Debouncing สามารถทำได้สองวิธี:

 - Debouncing Hardware: ใช้ตัวเก็บประจุ (Capacitor) ร่วมกับตัวต้านทาน (Resistor) เพื่อกรองสัญญาณรบกวน
 - Debouncing Software: ใช้โปรแกรมในการหน่วงเวลา (Delay) หรือการตรวจสอบสัญญาณหลายครั้งเพื่อกรองสัญญาณรบกวน

![Debouncing Hardware circuit](gpio-fundamental-debouncing-hardware-circuit.webp)
<i align="center">
  วงจร Debouncing
</i>

#### การใช้งาน Digital Input

1. การตรวจสอบปุ่มกด: ใช้ Digital Input ในการตรวจสอบสถานะปุ่มกดเพื่อควบคุมการทำงานของอุปกรณ์
2. การอ่านค่าจากเซ็นเซอร์: เซ็นเซอร์บางประเภท เช่น เซ็นเซอร์จับความเคลื่อนไหวหรือเซ็นเซอร์ตรวจจับแสง สามารถเชื่อมต่อกับ GPIO Input เพื่อรับสัญญาณดิจิทัลที่แสดงถึงสถานะการตรวจจับ
3. การตรวจสอบสถานะของสวิตช์: ใช้ Digital Input ในการตรวจสอบสถานะของสวิตช์ที่ใช้ในการเปิด/ปิดอุปกรณ์ไฟฟ้าหรือวงจรต่างๆ


#### สรุป
Digital Input เป็นพื้นฐานสำคัญในการรับสัญญาณจากอุปกรณ์ภายนอกเข้าสู่ไมโครคอนโทรลเลอร์ การทำความเข้าใจการทำงานของ Pull-up และ Pull-down Resistor รวมถึงการจัดการสัญญาณรบกวนด้วย Debouncing เป็นสิ่งสำคัญในการออกแบบและพัฒนาระบบอิเล็กทรอนิกส์ที่มีประสิทธิภาพและเชื่อถือได้


### 2.3 Analog Input

Analog Input ใช้ในการรับสัญญาณอนาล็อกจากเซ็นเซอร์หรืออุปกรณ์อื่นๆ ที่ให้ผลลัพธ์เป็นสัญญาณแรงดันไฟฟ้าต่อเนื่อง โดยทั่วไป Analog Input จะมีการใช้ ADC (Analog-to-Digital Converter) ในการแปลงสัญญาณอนาล็อกเป็นดิจิทัลเพื่อให้ไมโครคอนโทรลเลอร์สามารถประมวลผลข้อมูลได้

ADC เป็นวงจรหรืออุปกรณ์ที่ทำหน้าที่แปลงสัญญาณอนาล็อกเป็นสัญญาณดิจิทัล โดยทั่วไป ADC จะแบ่งสัญญาณแรงดันไฟฟ้าออกเป็นหลายระดับและแปลงเป็นค่าดิจิทัลที่มีความละเอียดขึ้นอยู่กับจำนวนบิตของ ADC

1. ความละเอียด (Resolution): ความละเอียดของ ADC ขึ้นอยู่กับจำนวนบิต ยิ่งจำนวนบิตสูง ความละเอียดของการแปลงสัญญาณจะยิ่งสูง ตัวอย่างเช่น ADC 10 บิต สามารถแปลงสัญญาณได้ 2^10 = 1024 ระดับ
2. ช่วงสัญญาณ (Input Range): ช่วงแรงดันไฟฟ้าที่ ADC สามารถรับได้ เช่น 0V ถึง 3.3V หรือ 0V ถึง 5V ขึ้นอยู่กับการออกแบบของวงจรและการตั้งค่าของ ADC
3. Sampling Rate: อัตราการเก็บตัวอย่างสัญญาณอนาล็อกต่อวินาที โดยทั่วไปแล้วอัตราการเก็บตัวอย่างสูงจะช่วยให้การแปลงสัญญาณมีความแม่นยำมากขึ้น

#### กระบวนการทำงานของ ADC

1. การเก็บตัวอย่าง (Sampling): ADC จะทำการเก็บตัวอย่างสัญญาณอนาล็อกในช่วงเวลาที่กำหนดไว้
2. การแปลง (Conversion): ADC จะแปลงสัญญาณอนาล็อกที่เก็บตัวอย่างไว้เป็นค่าดิจิทัล
3. การประมวลผล (Processing): ไมโครคอนโทรลเลอร์จะทำการประมวลผลค่าดิจิทัลที่ได้รับจาก ADC เพื่อนำไปใช้ในการควบคุมหรือการแสดงผลต่อไป

#### การใช้งาน Analog Input

Analog Input มักใช้กับเซ็นเซอร์หรืออุปกรณ์ที่ให้ผลลัพธ์เป็นสัญญาณอนาล็อก เช่น:

1. เซ็นเซอร์วัดอุณหภูมิ: เซ็นเซอร์วัดอุณหภูมิเช่น LM35 จะให้สัญญาณอนาล็อกที่เปลี่ยนแปลงตามอุณหภูมิ 
2. เซ็นเซอร์วัดความชื้น: เซ็นเซอร์วัดความชื้นเช่น HR202 จะให้สัญญาณอนาล็อกที่เปลี่ยนแปลงตามความชื้นในอากาศ
3. พอตมิเตอร์ (Potentiometer): พอตมิเตอร์ใช้ในการปรับแรงดันไฟฟ้าตามตำแหน่งของลูกบิด ซึ่งสามารถใช้ในการปรับค่าอินพุตให้กับ ADC
4. เซ็นเซอร์วัดแสง: เซ็นเซอร์วัดแสงเช่น LDR (Light Dependent Resistor) จะให้สัญญาณอนาล็อกที่เปลี่ยนแปลงตามความเข้มของแสง

หลังจากที่อ่านค่าดิจิทัลจาก ADC แล้ว ไมโครคอนโทรลเลอร์สามารถทำการประมวลผลข้อมูลเพื่อใช้ในการควบคุมหรือการแสดงผล

1. การแปลงค่าแรงดันไฟฟ้า: แปลงค่าดิจิทัลที่อ่านได้จาก ADC กลับไปเป็นค่าแรงดันไฟฟ้าโดยใช้สูตร: 

   ```
   float voltage = (value / 1024.0) * Vref;
   ```
   โดย value คือค่าดิจิทัลที่อ่านได้จาก ADC และ Vref คือแรงดันไฟฟ้าอ้างอิงของ ADC (เช่น 3.3V หรือ 5V)
2. การคำนวณค่าเซ็นเซอร์: แปลงค่าแรงดันไฟฟ้าที่ได้เป็นค่าที่ต้องการจากเซ็นเซอร์ เช่น อุณหภูมิ ความชื้น หรือความเข้มของแสง โดยใช้สมการหรือกราฟที่กำหนดไว้ในเอกสารของเซ็นเซอร์
3. การควบคุมอุปกรณ์: ใช้ค่าที่คำนวณได้ในการควบคุมอุปกรณ์ต่างๆ เช่น เปิด/ปิดพัดลมตามอุณหภูมิ หรือปรับความสว่างของแสงตามความเข้มของแสงที่วัดได้

#### สรุป
Analog Input เป็นพื้นฐานสำคัญในการรับสัญญาณอนาล็อกจากเซ็นเซอร์หรืออุปกรณ์อื่นๆ ไมโครคอนโทรลเลอร์จะใช้ ADC ในการแปลงสัญญาณอนาล็อกเป็นดิจิทัลเพื่อทำการประมวลผลและควบคุมอุปกรณ์ การทำความเข้าใจการตั้งค่าและการใช้งาน ADC รวมถึงการเชื่อมต่อและการประมวลผลข้อมูลจากเซ็นเซอร์เป็นสิ่งสำคัญในการออกแบบและพัฒนาระบบอิเล็กทรอนิกส์ที่มีประสิทธิภาพและเชื่อถือได้

### 2.4 Alternate Function Output

Alternate Function Output เป็นการใช้ขา GPIO สำหรับฟังก์ชันพิเศษที่นอกเหนือจากการทำงานเป็น Digital Input หรือ Digital Output ทั่วไป ฟังก์ชันพิเศษนี้มักจะถูกกำหนดโดยฮาร์ดแวร์ของไมโครคอนโทรลเลอร์ เช่น การสื่อสารข้อมูลผ่าน I2C, SPI, UART, PWM, หรือฟังก์ชันอื่นๆ ที่รองรับ

1. UART (Universal Asynchronous Receiver-Transmitter): ใช้สำหรับการสื่อสารแบบอนุกรมที่ไม่ต้องการสัญญาณนาฬิกา เช่น การสื่อสารกับคอมพิวเตอร์หรืออุปกรณ์อื่นๆ
2. SPI (Serial Peripheral Interface): ใช้สำหรับการสื่อสารแบบอนุกรมที่ต้องการสัญญาณนาฬิกา เช่น การสื่อสารกับเซ็นเซอร์หรือหน่วยความจำแฟลช
3. I2C (Inter-Integrated Circuit): ใช้สำหรับการสื่อสารแบบอนุกรมที่ต้องการสัญญาณนาฬิกา โดยสามารถเชื่อมต่ออุปกรณ์หลายตัวบนบัสเดียวกัน
4. PWM (Pulse Width Modulation): ใช้สำหรับการสร้างสัญญาณที่มีความกว้างของพัลส์ที่ปรับเปลี่ยนได้ เช่น การควบคุมความสว่างของ LED หรือความเร็วของมอเตอร์
5. Timer/Counter: ใช้สำหรับการนับหรือวัดเวลา เช่น การสร้างสัญญาณนาฬิกา หรือการวัดความถี่ของสัญญาณขาเข้า
6. ADC (Analog-to-Digital Converter): ใช้สำหรับการแปลงสัญญาณอนาล็อกเป็นดิจิทัล โดยบางขาของไมโครคอนโทรลเลอร์สามารถทำหน้าที่เป็นขาอินพุตของ ADC ได้
7. DAC (Digital-to-Analog Converter): ใช้สำหรับการแปลงสัญญาณดิจิทัลเป็นอนาล็อก โดยบางขาของไมโครคอนโทรลเลอร์สามารถทำหน้าที่เป็นขาเอาต์พุตของ DAC ได้

#### การตั้งค่า Alternate Function Output

การตั้งค่า Alternate Function Output ต้องการการกำหนดขา GPIO ให้ทำหน้าที่ตามฟังก์ชันที่ต้องการ โดยมีขั้นตอนหลักๆ ดังนี้:

1. การเลือกฟังก์ชัน: ตั้งค่าขา GPIO ให้ทำหน้าที่เป็น Alternate Function โดยการตั้งค่ารีจิสเตอร์ที่เกี่ยวข้อง
2. การตั้งค่ารีจิสเตอร์: ตั้งค่ารีจิสเตอร์ที่เกี่ยวข้องกับฟังก์ชันพิเศษนั้น เช่น การตั้งค่า Baud Rate สำหรับ UART หรือการตั้งค่า SPI Mode
3. การเปิดใช้งานฟังก์ชัน: เปิดใช้งานฟังก์ชันพิเศษในซอฟต์แวร์ โดยการใช้ไลบรารีหรือไดรเวอร์ที่รองรับ

การใช้งาน Alternate Function Output ในทางปฏิบัติต้องมีการพิจารณาหลายปัจจัย เช่น:

1. การเลือกขา GPIO ที่เหมาะสม: ตรวจสอบว่าไมโครคอนโทรลเลอร์รองรับฟังก์ชันที่ต้องการบนขา GPIO ที่เลือกหรือไม่
2. การตั้งค่าแรงดันไฟฟ้าและกระแส: ตรวจสอบว่าแรงดันและกระแสที่ใช้งานเหมาะสมกับฟังก์ชันพิเศษนั้นๆ หรือไม่
3. การป้องกันวงจร: ใช้ตัวต้านทาน, ตัวเก็บประจุ หรือวงจรป้องกันอื่นๆ เพื่อป้องกันการเกิดกระแสเกินหรือสัญญาณรบกวน

#### สรุป
Alternate Function Output เป็นฟังก์ชันพิเศษที่ช่วยให้ขา GPIO ของไมโครคอนโทรลเลอร์สามารถทำงานได้หลากหลายมากขึ้น เช่น การสื่อสารข้อมูลผ่าน UART, SPI, I2C, การสร้างสัญญาณ PWM, และการใช้ Timer/Counter การตั้งค่าและการใช้งานฟังก์ชันเหล่านี้ต้องมีความเข้าใจในฮาร์ดแวร์และซอฟต์แวร์ที่เกี่ยวข้องเพื่อให้สามารถออกแบบและพัฒนาระบบอิเล็กทรอนิกส์ที่มีประสิทธิภาพและเชื่อถือได้


## 3. การป้องกันวงจร และการเลือกไมโครคอนโทรลเลอร์

การป้องกันวงจรเป็นสิ่งสำคัญในการใช้งาน GPIO เพื่อป้องกันการเสียหายจากการใช้งานที่ไม่ถูกต้องหรือเหตุการณ์ที่ไม่คาดคิด

1. ตัวต้านทาน (Resistor): การใช้ตัวต้านทานแบบ Series กับขา GPIO สามารถช่วยจำกัดกระแสไฟฟ้าและป้องกันการเสียหายของไมโครคอนโทรลเลอร์
2. ตัวเก็บประจุ (Capacitor): การใช้ตัวเก็บประจุสามารถช่วยกรองสัญญาณรบกวนและลด EMI
3. Diod ป้องกันแรงดันกลับ (Flyback Diode): ใช้ในวงจรที่มีอินดักทีฟโหลด เช่น รีเลย์หรือมอเตอร์ เพื่อป้องกันแรงดันกลับที่เกิดขึ้นเมื่อโหลดถูกปิด

การเลือกไมโครคอนโทรลเลอร์ที่เหมาะสมกับโปรเจ็กต์เป็นสิ่งสำคัญสำหรับความสำเร็จของการพัฒนา

1. จำนวน GPIO: ตรวจสอบว่าไมโครคอนโทรลเลอร์มีจำนวน GPIO เพียงพอต่อความต้องการของโปรเจ็กต์
2. ความสามารถในการรองรับฟังก์ชันพิเศษ: ตรวจสอบว่าไมโครคอนโทรลเลอร์รองรับฟังก์ชันพิเศษที่ต้องการใช้งาน เช่น UART, SPI, I2C, PWM, ADC
3. แรงดันไฟฟ้าและกระแสที่รองรับ: ตรวจสอบว่าไมโครคอนโทรลเลอร์รองรับแรงดันไฟฟ้าและกระแสที่เหมาะสมกับอุปกรณ์ภายนอก

## 4. สรุป
บทความนี้ได้ครอบคลุมถึงพื้นฐานและการใช้งาน GPIO ในหลากหลายรูปแบบ รวมถึงการป้องกันวงจร หวังว่าบทความนี้จะเป็นประโยชน์กับผู้ที่สนใจศึกษาเรื่อง GPIO และการใช้งานในไมโครคอนโทรลเลอร์นะครับ 😊

## Reference

[Open Drain Output vs. Push-Pull Output](https://open4tech.com/open-drain-output-vs-push-pull-output/)
[Why Are Pull-Up and Pull-Down Resistors Used?](https://www.circuitbread.com/ee-faq/why-are-pull-up-and-pull-down-resistors-used)
[PULL-UP AND PULL-DOWN RESISTORS](https://www.circuitbasics.com/pull-up-and-pull-down-resistors/)
[Pull-up Resistors](https://www.electronics-tutorials.ws/logic/pull-up-resistor.html)
